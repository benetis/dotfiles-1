#!/bin/sh

merge(){
  cat <<EOF > "$HOME/.ssh/$1"
#
# Do not edit this file manually, it will be overwritten, when running ~/.bin/ssh.
# Instead, add your configuration to ~/.ssh/$1.d/
#
EOF
  find -L "$1.d/" -type f -a -not -name '*.example' -a -not -name '*.pem' | sort | xargs cat >> "$1"
}

merge "authorized_keys"
merge "config"
merge "known_hosts"

exec command-p ssh "$@"
