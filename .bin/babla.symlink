#!/usr/bin/perl

use strict;
use warnings;
use utf8;
use Encode;
use LWP::Simple qw(get);

binmode(STDOUT, ":utf8");
binmode(STDERR, ":utf8");
binmode(STDIN,  ":utf8");

sub babla {
  my $text = get("http://en.bab.la/dictionary/polish-english/" . shift);
  exit 1 unless ($text =~ m/^.*<h4><i class="icon-chevron-right"><\/i>Summary<\/h4>(.*?)<h4><i class="icon-chevron-right"><\/i>Synonyms<\/h4>.*$/gis);
  $text = $1;
  $text =~ s/<br>/ â€” /gis;
  $text =~ s/<\/p>\s*<p>/\0/gis;
  $text =~ s/<.*?>/ /gis;
  $text =~ s/&nbsp;?/ /gis;
  $text =~ s/^\s+|\s+$//gis;
  $text =~ s/\s+/ /gis;
  $text =~ s/\s+full\s+details$//gis;
  $text =~ s/\s*\0\s*/\n/gis;
  return $text;
}

if (scalar(@ARGV) > 0) {
  print babla(join(" ", map { Encode::_utf8_on($_); $_ } @ARGV)) . "\n";
} else {
  print babla($_) while (<>);
}
